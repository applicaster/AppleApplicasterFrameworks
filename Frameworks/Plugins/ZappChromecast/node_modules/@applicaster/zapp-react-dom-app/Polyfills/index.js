/* global navigator */
/* global window */
/* global tizen */
import { QuickBrickCommunicationModule } from "./QuickBrickCommunicationModule";
import { AnalyticsBridge } from "./AnalyticsBridge";
import { getStorageModule } from "./Storage";
import { DeviceEventEmitter } from "./DeviceEventEmitter";

const isTizen = typeof tizen !== "undefined";

export function registerNativeModulesPolyfills(NativeModules) {
  NativeModules.QuickBrickCommunicationModule = QuickBrickCommunicationModule;
  NativeModules.AnalyticsBridge = AnalyticsBridge;
  NativeModules.SessionStorage = getStorageModule("sessionStorage");
  NativeModules.LocalStorage = getStorageModule("localStorage");
}

function getWebPlatform(fallbackPlatform) {
  try {
    const { userAgent } = navigator || window.navigator;
    // Note: LG uses the number 0 in their userAgent, possibly because of Palm WebOS
    if (userAgent.includes("Web0S")) {
      return "lg_tv";
    }

    if (
      isTizen ||
      userAgent.includes("SMART-TV") ||
      userAgent.includes("Tizen")
    ) {
      return "samsung_tv";
    }

    return "web";
  } catch (e) {
    return fallbackPlatform;
  }
}

export function overloadReactNativePlatform(Platform, fallbackPlatform) {
  if (Platform.OS === "web") {
    Platform.OS = getWebPlatform(fallbackPlatform);
  }
}

export function addReactNativeModules(ReactNative) {
  ReactNative.DeviceEventEmitter = DeviceEventEmitter;
}
