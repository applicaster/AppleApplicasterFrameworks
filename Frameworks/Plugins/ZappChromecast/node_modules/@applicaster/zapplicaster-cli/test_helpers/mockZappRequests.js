const nock = require("nock");
const R = require("ramda");

const VERSION_ID = "e7a17c6f-4113-41ac-9450-6281d22153a1";
const build_params = require("./appBuildParams.json");

const ZAPP_URL = "https://zapp.applicaster.com";
const BUILD_PARAMS_ENDPOINT = "/api/v1/admin/build_params";

const ZAPP_S3_URL = "https://assets-secure.applicaster.com";
const ZAPP_S3_ENDPOINT = "/zapp/accounts";

function mockZappRequests(
  appVersionId = VERSION_ID,
  code = 200,
  response = build_params
) {
  nock(ZAPP_URL)
    .persist()
    .get(R.includes(BUILD_PARAMS_ENDPOINT))
    .query(R.propEq("app_version_id", appVersionId))
    .reply(code, response);
}

function mockConfigFileRequest(
  appVersionId = VERSION_ID,
  code = 200,
  response = {}
) {
  nock(ZAPP_S3_URL)
    .persist()
    .get(R.includes(ZAPP_S3_ENDPOINT))
    .reply(code, response);
}

function cleanMocks() {
  nock.cleanAll();
}

module.exports = { mockZappRequests, mockConfigFileRequest, cleanMocks };
