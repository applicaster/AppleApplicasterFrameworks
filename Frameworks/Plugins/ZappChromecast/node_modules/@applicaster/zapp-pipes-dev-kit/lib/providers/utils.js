"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseQueryParameters = undefined;

var _url = require("url");

var _url2 = _interopRequireDefault(_url);

var _queryString = require("query-string");

var _queryString2 = _interopRequireDefault(_queryString);

var _Base = require("../Base64");

var _ramda = require("ramda");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var isValidUrl = (0, _ramda.compose)((0, _ramda.test)(/^(http)/), (0, _ramda.prop)("url"));

var parseAdditionalParams = function parseAdditionalParams(obj) {
  return (0, _ramda.compose)((0, _ramda.merge)(_ramda.__, obj), (0, _ramda.when)((0, _ramda.either)((0, _ramda.has)("url"), (0, _ramda.has)("type")), wrapInParamsProp), (0, _ramda.when)((0, _ramda.has)("search"), (0, _ramda.compose)(_queryString2.default.parse, (0, _ramda.prop)("search"))), _url2.default.parse, (0, _ramda.prop)("url"))(obj);
};

var wrapInParamsProp = function wrapInParamsProp(obj) {
  return (0, _ramda.compose)((0, _ramda.assoc)("params", _ramda.__, obj), (0, _ramda.pick)(["url", "type"]))(obj);
};

var decodeZappUrl = (0, _ramda.tryCatch)((0, _ramda.compose)(_Base.atob, decodeURIComponent), (0, _ramda.flip)(_ramda.identity));

var decodeUrl = (0, _ramda.over)((0, _ramda.lensProp)("url"), decodeZappUrl);

var processUrl = (0, _ramda.compose)(parseAdditionalParams, (0, _ramda.unless)(isValidUrl, decodeUrl));

var parseQueryParameters = exports.parseQueryParameters = (0, _ramda.when)((0, _ramda.has)("url"), processUrl);