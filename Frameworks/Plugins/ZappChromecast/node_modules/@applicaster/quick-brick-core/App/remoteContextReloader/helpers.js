// @flow

import axios from "axios";
import camelize from "camelize";
import * as R from "ramda";

import { URL_KEY_SUFFIX } from "./consts";

export const urlKeyToContext = R.compose(
  camelize,
  R.replace(URL_KEY_SUFFIX, "")
);

export function getPromiseForKey(runtimeConfigurationUrls) {
  return async function(urlKey) {
    const context = urlKeyToContext(urlKey);
    const url = R.prop(urlKey, runtimeConfigurationUrls);
    try {
      const response = await axios.get(url);

      const { data } = response;

      return {
        [context]: data,
      };
    } catch (e) {
      throw new Error("cannot retrieve configuration data for " + urlKey);
    }
  };
}
