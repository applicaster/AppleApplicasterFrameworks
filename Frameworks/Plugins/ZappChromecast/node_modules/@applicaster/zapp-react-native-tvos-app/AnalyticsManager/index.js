import * as R from "ramda";
import { NativeModules } from "react-native";

const { AnalyticsBridge } = NativeModules;

/**
 * Post to Apple TV application for event type and additional params
 *
 * @param {string} eventName Analytic event name
 * @param {Object} payload   Additonal parameters that will be passed with event
 */
export function postAnalyticEvent(eventName, payload) {
  if (isValidAnalyticsData(eventName, payload)) {
    AnalyticsBridge.postEvent(eventName, payload);
  }
}

/**
 * Notify AppleTV application that timed event was started for event type and additional params.
 *
 * @param {string} eventName Analytic event name
 * @param {Object} payload   Additonal parameters that will be passed with event
 */
export function startAnalyticsTimedEvent(eventName, payload) {
  if (isValidAnalyticsData(eventName, payload)) {
    AnalyticsBridge.postTimedEvent(eventName, payload);
  }
}

/**
 * Notify AppleTV application that timed event was finished for event type and additional params.
 *
 * @param {string} eventName Analytic event name
 * @param {Object} payload   Additonal parameters that will be passed with event
 */
export function endAnalyticsTimedEvent(eventName, payload) {
  if (isValidAnalyticsData(eventName, payload)) {
    AnalyticsBridge.endTimedEvent(eventName, payload);
  }
}

/**
 * Checks if analytics data to pass wass passsed expected values
 *
 * @param {string} eventName Analytic event name
 * @param {Object} payload   Additonal parameters that will be passed with event
 *
 * @returns {boolean} True in case if parameters suitable for manager to send, otherwise false
 */
export function isValidAnalyticsData(eventName, payload = null) {
  const eventExist = R.is(String, eventName);
  // we allow payload to be null, but we're leveraging here the fact that typeof null === "object"
  const payloadObjectOrNil = typeof payload === "object";

  return eventExist && payloadObjectOrNil;
}
