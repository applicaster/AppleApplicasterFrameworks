// const { existsSync } = require("fs");
const semver = require("semver");
const R = require("ramda");

/**
 * Checks wether the workspace can be prepared
 * @param {any} { cliArgs, cliOptions } : CLI argument and options
 */
function prerequisitesChecker({ cliArgs, cliOptions }) {
  const {
    ZAPP_TOKEN,
    // the following properties are commented out because of aws removal for now
    // HOME,
    // AWS_ACCESS_KEY_ID,
    // AWS_SECRET_ACCESS_KEY,
  } = process.env;

  // has aws credentials - commented out as we're removing the aws requirement for now
  // if (
  //   !(
  //     existsSync(`${HOME}/.aws/credentials`) ||
  //     (AWS_ACCESS_KEY_ID && AWS_SECRET_ACCESS_KEY)
  //   )
  // ) {
  //   throw new Error(
  //     "AWS Credentials are not defined - please set them as environment variables, or run aws-cli configure"
  //   );
  // }

  // has ZAPP_TOKEN
  if (R.isNil(ZAPP_TOKEN)) {
    throw new Error(
      "No ZAPP_TOKEN defined - please add your ZAPP_TOKEN to your environment variables"
    );
  }

  // runs node ^8.0.0
  if (
    !(
      semver.satisfies(process.version, "^8.0.0") ||
      semver.satisfies(process.version, "^12.0.0")
    )
  ) {
    throw new Error(
      "Unsupported node version - please use any version compliant with ^8.0.0"
    );
  }
  // runs yarn 1.3.2+
  return true;
}

module.exports = { prerequisitesChecker };
