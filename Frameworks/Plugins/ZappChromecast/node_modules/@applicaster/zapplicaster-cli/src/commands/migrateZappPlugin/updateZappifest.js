const { resolve } = require("path");
const { writeJsonToFile } = require("../../file");

async function renderUpdatedZappifest({
  name,
  cwd,
  version,
  zappifestFileName,
}) {
  const zappifest = require(resolve(cwd, zappifestFileName));

  zappifest.dependency_name = name;
  zappifest.dependency_version = version;

  await writeJsonToFile(resolve(cwd, zappifestFileName), zappifest);
}

async function updateZappifest(config) {
  const { cwd, zappifests } = config;

  const packageJson = require(resolve(cwd, "package.json"));

  const { name, version } = packageJson;

  await renderUpdatedZappifest({
    name,
    version,
    cwd,
    zappifestFileName: zappifests.ios,
  });

  await renderUpdatedZappifest({
    name,
    version,
    cwd,
    zappifestFileName: zappifests.android,
  });
}

module.exports = { updateZappifest };
