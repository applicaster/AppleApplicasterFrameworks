const git = require("simple-git/promise");

const logger = require("../../logger");

async function commitToGit(configuration) {
  const {
    pluginPath,
    skipGit,
    dryRun,
    version,
    pluginPackageJson,
  } = configuration;

  const { name } = pluginPackageJson;

  if (skipGit || dryRun) {
    logger.log(
      "Running with --skip-git or --dry-run flag, changes won't be commited"
    );
    return true;
  }

  const gitInstance = git(pluginPath);

  try {
    await gitInstance.add(".");
    await gitInstance.commit(`chore: publish ${name}@${version}`);

    return true;
  } catch (e) {
    throw e;
  }
}

module.exports = { commitToGit };
