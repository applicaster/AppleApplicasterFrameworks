import React from "react";
import { shallow } from "enzyme";
import { shallowToJson } from "enzyme-to-json";
import { View } from "react-native";
import configureStore from "redux-mock-store";

import { ZappApp } from "../../index";

const dimensions = { window: { height: 1337, width: 750 } };

const store = configureStore()({});

const Screen = props => <View />;
Screen.displayName = "Screen";

const AppContainer = ({ children }: any) => <View>{children(dimensions)}</View>;
AppContainer.displayName = "AppContainer";

const runtimeConfigurationUrls = {
  styles_url: "http://zapp.com/styles.json",
};

const zappAppProps = {
  components: {
    Screen,
    AppContainer,
  },
  rivers: [{ id: "1", home: false }, { id: 2, home: true }],
  styles: { color: "blue" },
  appSettings: {
    runtimeConfigurationUrls,
  },
  dispatch: jest.fn(),
};

jest.mock("NativeModules", () => ({
  QuickBrickCommunicationModule: {
    quickBrickEvent: jest.fn(),
    accountId: 123,
    accountsAccountId: "accountsAccountIDString1234",
    broadcasterId: 145,
    bundleIdentifier: "com.apptestname",
    initialProps: {
      foo: "bar",
    },
  },
}));

describe("<ZappApp />", () => {
  it("renders correctly", () => {
    const wrapper = shallow(<ZappApp {...zappAppProps} />, {
      context: { store },
    });
    expect(shallowToJson(wrapper)).toMatchSnapshot();
  });
});
