import * as AppDataPolyfill from "../AppData";
import * as R from "ramda";

const QuickBrickEventEmitter = {};

export const QuickBrickEvents = (function(eventEmitter) {
  let listeners = [];

  function unsubscribe(listener) {
    return function() {
      listeners = R.reject(R.is(listener), listeners);
    };
  }

  function subscribe(listener) {
    listeners.push(listener);
    return unsubscribe(listener);
  }

  eventEmitter.sendEvent = function(event, payload) {
    R.forEach(listener => {
      listener(event, payload);
    }, listeners);
  };

  return {
    subscribe,
  };
})(QuickBrickEventEmitter);

function quickBrickEvent(eventName, payload) {
  QuickBrickEventEmitter.sendEvent(eventName, payload);
}

const initialProps = {}; // required for legacy plugins;

export const QuickBrickCommunicationModule = {
  quickBrickEvent,
  initialProps,
  ...AppDataPolyfill.getAppData(),
};
