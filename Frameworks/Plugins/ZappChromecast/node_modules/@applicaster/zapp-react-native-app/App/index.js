// @flow
import * as React from "react";
import * as R from "ramda";
import { NativeRouter, useLocation, useHistory } from "react-router-native";

import { createQuickBrickApp } from "@applicaster/quick-brick-core";
import * as Contexts from "@applicaster/zapp-react-native-ui-components/Contexts";
import * as QuickBrickManager from "@applicaster/zapp-react-native-bridge/QuickBrick";
import { OfflineHandler } from "@applicaster/zapp-react-native-ui-components/Components/OfflineHandler";

import { withInteractionManager } from "./InteractionManager";

import type {
  ZappScreenProps,
  ZappRivers,
} from "@applicaster/zapp-react-native-flow-types";

import { Layout } from "./Layout";

type Props = ZappScreenProps & ZappRivers;

export const ZappApp: React.ComponentType<Props> = createQuickBrickApp({
  navigations: {
    Router: NativeRouter,
    useHistory,
    useLocation,
  },
  QuickBrickManager,
  Layout,
  OfflineHandler,
  InteractionManager: withInteractionManager, // mostly back button handle in Android
  ContextProviders: R.map(R.prop("withProvider"), R.values(Contexts)),
});
