import axios from "axios";
import * as R from "ramda";

function fetchLocalization({ locale, url }) {
  return axios
    .get(url)
    .then(R.prop("data"))
    .then(R.assoc(locale, R.__, {}));
}

export function loadLocalizations(localizations, dispatch) {
  const localizationsPromises = R.compose(
    R.map(fetchLocalization),
    R.values,
    R.mapObjIndexed((url, locale) => ({ locale, url }))
  )(localizations);

  const baseAction = { type: "LOAD_LOCALIZATIONS" };

  return Promise.all(localizationsPromises)
    .then(R.reduce(R.merge, {}))
    .then(R.assoc("payload", R.__, baseAction))
    .then(dispatch);
}
