const AWS = jest.genMockFromModule("aws-sdk");

function listObject({ Prefix }, callback) {
  callback(null, { Contents: ["list", "of", "objects"] });
}

function getObject({ Key }, callback) {
  if (Key.includes("THROW")) {
    callback(new Error("something wrong happened"));
    return;
  }

  callback(null, {
    Body: Buffer.from(JSON.stringify({ bar: "baz" })),
    ETag: "ETag_value",
  });
}

function putObject({ Key, Body, ACL }, callback) {
  callback(null, Body.toString());
}

function deleteObject({ Key }, callback) {
  callback(null, { status: "OK" });
}

function S3(config) {
  return {
    listObject: jest.fn(listObject),
    getObject: jest.fn(getObject),
    putObject: jest.fn(putObject),
    deleteObject: jest.fn(deleteObject),
  };
}

AWS.S3 = jest.fn(S3);

module.exports = AWS;
